{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Marketplace - Página Inicial</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="{% static 'css/cores.css' %}">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid">
            <h1 class="navbar-brand mb-0 fw-bold fs-2 text-light d-flex align-items-center">
                <a href="{% url 'home' %}" class="bg-warning text-primary px-3 py-1 rounded me-2">Preço certo</a>
            </h1>
            {% if usuario_empresa %}
                <div class="d-flex ms-auto">
                    <a href="{% url 'editar_empresa' usuario_empresa.id %}" class="btn btn-warning text-dark me-2">Editar Empresa</a>
                    <a href="{% url 'deletar_empresa' usuario_empresa.id %}" class="btn btn-danger me-2">Deletar Conta</a>
                    <a href="{% url 'logout' %}" class="btn btn-outline-light">Logout</a>
                </div>
            {% elif usuario_cliente %}
                <div class="d-flex ms-auto">
                    <a href="#" class="btn btn-success me-2">Carrinho</a>
                    <span class="btn btn-outline-secondary disabled me-2">Bem-vindo, {{ usuario_cliente.nome }}</span>
                    <a href="{% url 'logout' %}" class="btn btn-outline-light">Logout</a>
                </div>
            {% else %}
                <form method="post" class="d-flex ms-auto me-3" role="search">
                    {% csrf_token %}
                    <input class="form-control me-2" type="search" placeholder="Buscar produtos..." aria-label="Search">
                    <button class="btn btn-light text-primary" type="submit">Buscar</button>
                </form>
                <div class="d-flex">
                    <a href="{% url 'criar_cliente' %}" class="btn btn-warning text-dark me-2">Criar Cliente</a>
                    <a href="{% url 'logar_cliente' %}" class="btn btn-light text-primary me-2">Login Cliente</a>
                    <a href="{% url 'criar_empresa' %}" class="btn btn-warning text-dark me-2">Criar Empresa</a>
                    <a href="{% url 'logar_empresa'%}" class="btn btn-light text-primary">Login Empresa</a>
                </div>
            {% endif %}
        </div>
    </nav>
    <div class="container mt-4">
        {% if usuario_cliente or not usuario_empresa %}
            <h2 class="mb-4">Produtos em destaque</h2>
            <div class="row">
                {% for produto in produtos %}
                <div class="col-md-4 mb-4">
                    <div class="card h-100 d-flex flex-column align-items-stretch">
                       {% if produto.imagem %}
                        <img src="{{ produto.imagem.url }}" class="card-img-top mx-auto d-block mt-3" alt="{{ produto.nome }}" style="height: 160px; width: auto; object-fit: contain; max-width: 80%;">
                        {% else %}
                        <img src="{% static 'img/placeholder.png' %}" class="card-img-top mx-auto d-block mt-3" alt="Sem imagem" style="height: 160px; width: auto; object-fit: contain; max-width: 80%;">
                        {% endif %}
                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title">{{ produto.nome }}</h5>
                            <p class="card-text">{{ produto.descricao|truncatechars:80 }}</p>
                            <p class="card-text fw-bold text-success">R$ {{ produto.preco }}</p>
                            <a href="{% url 'detalhe_produto' pk=produto.id %}" class="btn btn-outline-primary mt-auto">Ver detalhes</a>
                        </div>
                    </div>
                </div>
                {% empty %}
                <p>Nenhum produto cadastrado.</p>
                {% endfor %}
            </div>
        {% elif usuario_empresa %}
            <div class="d-flex justify-content-end mb-3">
                <a href="{% url 'criar_produto' %}" class="btn btn-warning text-dark me-2">Adicionar Produto</a>
            </div>
            <h2 class="mb-4">Produtos da sua empresa</h2>
            <div class="row">
                {% if produtos_empresa %}
                    {% for produto in produtos_empresa %}
                    <div class="col-md-4 mb-4">
                        <div class="card h-100 d-flex flex-column align-items-stretch">
                            {% if produto.imagem %}
                            <img src="{{ produto.imagem.url }}" class="card-img-top mx-auto d-block mt-3" alt="{{ produto.nome }}" style="height: 160px; width: auto; object-fit: contain; max-width: 80%;">
                            {% else %}
                            <img src="{% static 'img/placeholder.png' %}" class="card-img-top mx-auto d-block mt-3" alt="Sem imagem" style="height: 160px; width: auto; object-fit: contain; max-width: 80%;">
                            {% endif %}
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title">{{ produto.nome }}</h5>
                                <p class="card-text">{{ produto.descricao|truncatechars:80 }}</p>
                                <p class="card-text fw-bold text-success">R$ {{ produto.preco }}</p>
                                <div class="mt-auto d-flex justify-content-between">
                                    <a href="{% url 'detalhe_produto' pk=produto.id %}" class="btn btn-outline-primary">Ver detalhes</a>
                                    <a href="{% url 'editar_produto' pk=produto.id %}" class="btn btn-outline-warning ms-2">Editar</a>
                                    <a href="{% url 'deletar_produto' pk=produto.id %}" class="btn btn-outline-danger ms-2">Excluir</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% empty %}
                    <p>Nenhum produto cadastrado para sua empresa.</p>
                    {% endfor %}
                {% else %}
                    <h2 class="mb-4">Bem-vindo, {{ usuario_empresa.nome }}</h2>
                    <div class="alert alert-info mt-4">Você está logado como empresa. Utilize os botões acima para gerenciar seus produtos ou deletar sua conta.</div>
                {% endif %}
            </div>
        {% endif %}
    </div>
</body>
</html>